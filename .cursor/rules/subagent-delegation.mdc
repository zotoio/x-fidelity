---
description: Guidelines for automatic subagent delegation and parallel execution
alwaysApply: true
---

# X-Fidelity Subagent Delegation

## Automatic Delegation

When working on X-Fidelity tasks, proactively delegate to specialized subagents based on context. Each subagent is a Subject Matter Expert in their domain.

## Subagent Trigger Conditions

### xfi-build-expert
**Auto-trigger when:**
- Build command fails (`yarn build`, `turbo build`)
- Dependency resolution errors
- TypeScript compilation errors across packages
- CI pipeline failures
- esbuild bundling issues

### xfi-testing-expert
**Auto-trigger when:**
- Test command fails (`yarn test`)
- Coverage thresholds not met
- Jest configuration issues
- Mock setup problems
- VSCode extension test failures

### xfi-plugin-expert
**Auto-trigger when:**
- Creating or modifying plugins in `packages/x-fidelity-plugins/`
- AST analysis or tree-sitter issues
- Fact or operator development
- Rule JSON creation

### xfi-vscode-expert
**Auto-trigger when:**
- Working in `packages/x-fidelity-vscode/`
- Extension activation issues
- Webview or tree view problems
- CLI-Extension consistency failures
- F5 debug workflow issues

### xfi-rules-expert
**Auto-trigger when:**
- Creating or modifying archetypes
- Rule definition issues
- Exemption configuration
- json-rules-engine problems

### xfi-security-expert
**Auto-trigger when:**
- Path validation errors
- Security review requests
- Webhook implementation
- Secret handling code changes

### xfi-debugger
**Auto-trigger when:**
- Runtime errors with stack traces
- Unexpected behavior
- Log analysis needed
- Error code investigation (1000-1699)

### xfi-docs-expert
**Auto-trigger when:**
- README.md needs updating
- Website documentation changes
- API documentation
- After significant code changes

### xfi-code-reviewer
**Auto-trigger when:**
- Code changes ready for review
- Before creating commits
- PR review requests
- After completing a feature

### xfi-system-design
**Auto-trigger when:**
- Planning new features or enhancements
- Architecture decisions are needed
- Cross-package changes are being designed
- Technical design documentation is required
- Understanding platform-wide impact of changes
- Feature specifications need to be written

### xfi-planner
**Auto-trigger when:**
- User invokes `/xfi-plan` command
- Complex multi-step engineering initiatives
- Need to coordinate multiple subagents on a project
- Plan execution via `/xfi-plan-execute` command
- Breaking down features into subtasks
- Tracking progress across multiple work streams

### xfi-engineer
**Auto-trigger when:**
- Implementation tasks from plan subtasks
- Coding and feature development work
- Bug fixes requiring code changes
- Refactoring tasks
- General engineering work not specific to other domains
- Plan subtask execution when assigned

### crux-rule-expert
**Auto-trigger when:**
- User asks to compress rules, AGENTS.md
- Need to reduce token usage for context-heavy files
- Preparing compressed reference material for LLM context
- Converting verbose Markdown to compact CRUX notation

## Parallel Execution Strategy

### Independent Tasks (Run in Parallel)
When multiple aspects need attention simultaneously, launch subagents in parallel:

```
Example scenario: After implementing a new plugin
├── xfi-plugin-expert (verify plugin structure)
├── xfi-testing-expert (check test coverage)
├── xfi-code-reviewer (review code quality)
└── xfi-docs-expert (check documentation)
```

### Dependent Tasks (Run Sequentially)
When tasks have dependencies, run them in order:

```
Example scenario: Fixing a build failure
1. xfi-build-expert (diagnose and fix)
2. xfi-testing-expert (verify tests pass)
3. xfi-code-reviewer (review the fix)
```

## Delegation Best Practices

1. **Be proactive**: Don't wait for explicit requests to delegate
2. **Use parallel execution**: When domains are independent, run multiple subagents
3. **Provide context**: Include relevant error messages, file paths, and symptoms
4. **Trust subagent output**: Subagents are SMEs in their domains
5. **Combine insights**: Synthesize results from multiple subagents

## Example Delegations

### Build Failure
```
Task the xfi-build-expert subagent with:
"Diagnose this build failure: [error output]
Focus on: dependency order, turbo config, esbuild externals"
```

### New Feature Complete
```
Task these subagents in parallel:
- xfi-code-reviewer: "Review changes in [files] for quality and security"
- xfi-testing-expert: "Verify test coverage for new functionality"
- xfi-docs-expert: "Check if README or website needs updates"
```

### Runtime Error
```
Task the xfi-debugger subagent with:
"Investigate this error: [stack trace]
Context: [what operation was being performed]"
```

### New Feature Planning
```
Task the xfi-system-design subagent with:
"Design [feature name]: [requirements]
Consider: affected packages, architecture impact, integration points"
```

### Architecture Review Before Major Changes
```
Task these subagents in sequence:
1. xfi-system-design: "Create architecture design for [feature]"
2. xfi-code-reviewer: "Review the proposed design"
3. xfi-docs-expert: "Identify documentation requirements"
```

### Complex Multi-Step Initiative
```
Task the xfi-planner subagent with:
"Plan this engineering initiative: [description]
Break it down into subtasks with clear deliverables and dependencies"
```

### Execute an Engineering Plan
```
Task the xfi-planner subagent with:
"Execute plan: knowledge/plans/[yyyymmdd]-[feature-name]/
Coordinate subtask execution per the dependency graph"
```

### Implementation Task
```
Task the xfi-engineer subagent with:
"Implement: [task description]
Files to modify: [list of files]
Requirements: [specific requirements]"
```

### Compress Documentation
```
Task the crux-rule-expert subagent with:
"Compress this file into Ultra notation: [file path]
Target: <20% of original size while preserving all actionable information"
```
